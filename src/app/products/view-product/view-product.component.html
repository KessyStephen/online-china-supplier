<div class="page-header has-tab" *ngIf="!isLoading">
    <div class="d-md-flex m-b-15 align-items-center justify-content-between">
        <div class="media align-items-center m-b-15">
            <nz-avatar nzShape="square" *ngIf="isEdit" [nzSize]="70" [nzSrc]="product.thumbnail"></nz-avatar>
            <div class="m-l-15">
                <h4 class="m-b-0" *ngIf="isEdit">{{product.translations.en.name}}</h4>
            </div>           
        </div>
        <div class="m-b-15">
            <button [nzLoading]="saveLoading" nz-button nzType="primary" [disabled]="productEditForm.invalid && productImages.length == 0" *ngIf="!isEdit" (click)="save()">
                <i nz-icon nzType="save" theme="outline"></i>
                <span>Save</span>
            </button>
            <button nz-button nzType="default" *ngIf="isEdit" (click)="edit()">
                <i nz-icon nzType="edit" theme="outline"></i>
                <span>Update</span>
            </button>
        </div>
    </div>
</div>

<form nz-form nzLayout="vertical" [formGroup]="productEditForm" *ngIf="!isLoading">
    <nz-tabset class="page-header-tab">
        <nz-tab nzTitle="Basic Info">
            <nz-card>
                <div class='row'>
                    <nz-form-item class="col-md-6">
                        <nz-form-label nzFor="category" nzRequired>Category</nz-form-label>
                        <nz-form-control nzErrorTip="Category can not be empty">
                            <nz-select formControlName="category" class="w-100"
                                (ngModelChange)="onCategorySelected($event)">
                                <nz-option *ngFor='let category of categories' [nzValue]='category._id'
                                    [nzLabel]='category.translations.en.name'></nz-option>
                            </nz-select>
                        </nz-form-control>
                    </nz-form-item>

                    <nz-form-item class="col-md-6">
                        <nz-form-label nzFor="category" nzRequired>Sub Category</nz-form-label>
                        <nz-form-control nzErrorTip="Category can not be empty">
                            <nz-select formControlName="categoryId" class="w-100" (ngModelChange)="onSubcategoryChanged($event)">
                                <nz-option *ngFor='let category of subCategories' [nzValue]='category._id' 
                                    [nzLabel]='category.translations.en.name'></nz-option>
                            </nz-select>
                        </nz-form-control>
                    </nz-form-item>
                </div>

                <nz-form-item>
                    <nz-form-label nzFor="productName" nzRequired>Product Name</nz-form-label>
                    <nz-form-control nzErrorTip="Please input this field!">
                        <input nz-input formControlName="productName" type="text">
                    </nz-form-control>
                </nz-form-item>

                <nz-form-item>
                    <nz-form-label nzFor="description" nzRequired>Description</nz-form-label>
                    <quill-editor formControlName="description" [style]="{height: '250px'}" [modules]="editorConfig"
                        placeholder=""></quill-editor>
                </nz-form-item>

            </nz-card>
        </nz-tab>
        <nz-tab nzTitle="Option Info" *ngIf="attributeData.length > 0">
            <nz-card>
                <div [formGroup]='attributes'>
                    <div *ngFor="let attribute of attributeData; let i = index;">
                        <nz-form-item>
                            <nz-form-control nzErrorTip="Please input this field!">
                                <nz-form-label [nzFor]="attribute.name">{{attribute.name}}</nz-form-label>
                                <nz-select [formControlName]="attribute.name" class="w-100" nzMode="multiple">
                                    <nz-option *ngFor="let option of attribute.options" [nzLabel]="option"
                                        [nzValue]="option"></nz-option>
                                </nz-select>
                            </nz-form-control>
                        </nz-form-item>
                    </div>
                </div>

            </nz-card>
        </nz-tab>
        <nz-tab nzTitle="Price Details">
            <nz-card>

                <nz-form-item>
                    <nz-form-label nzFor="currency" nzRequired>Currency</nz-form-label>
                    <nz-form-control nzErrorTip="Please input this field!">
                        <nz-select style="min-width: 220px;" formControlName="currency" class="w-100" nzPlaceHolder="Currency">
                            <nz-option nzLabel="USD" nzValue="USD"></nz-option>
                            <nz-option nzLabel="TZS" nzValue="TZS"></nz-option>
                        </nz-select>
                    </nz-form-control>
                </nz-form-item>

                <nz-form-item>
                    <nz-form-label nzFor="price" nzRequired>Price</nz-form-label>
                    <nz-form-control nzErrorTip="Please input this field!">
                        <nz-input-group [nzPrefix]="pricePrefix">
                            <input nz-input formControlName="price" type="text">
                        </nz-input-group>
                        <ng-template #pricePrefix>
                            <span>$</span>
                        </ng-template>
                    </nz-form-control>
                </nz-form-item>

                <nz-form-item>
                    <nz-form-label nzFor="sku" nzRequired>SKU</nz-form-label>
                    <nz-form-control nzErrorTip="Please input this field!">
                        <input nz-input formControlName="sku" type="text">
                    </nz-form-control>
                </nz-form-item>

                <nz-form-item>
                    <nz-form-label nzFor="quality" nzRequired>Quality</nz-form-label>
                    <nz-form-control nzErrorTip="Please input this field!">
                        <input nz-input formControlName="quality" type="text">
                    </nz-form-control>
                </nz-form-item>

            </nz-card>
        </nz-tab>
        <nz-tab nzTitle="Product Images">
            <nz-card>
                <nz-upload nzListType="picture-card" [(nzFileList)]="fileList" [nzShowButton]="fileList.length < 15"
                    [nzPreview]="handlePreview" [nzCustomRequest]='handleRequest'>
                    <i nz-icon nzType="plus"></i>
                    <div class="ant-upload-text">Upload</div>
                </nz-upload>
                <nz-modal [nzVisible]="previewVisible" [nzContent]="modalContent" [nzFooter]="null"
                    (nzOnCancel)="previewVisible=false">
                    <ng-template #modalContent>
                        <img [src]="previewImage" [ngStyle]="{ 'width': '100%', 'height':'100%' }" />
                    </ng-template>
                </nz-modal>
            </nz-card>
        </nz-tab>
    </nz-tabset>
</form>